<head>
<script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
</head>

<div id="app">
  {{ page.pageTitle }} ({{ page.id }})
  <br>
  <block
    v-for="block in page.children"
    v-bind:block="block"
    v-bind:level="0"
    v-bind:key="block.id">
  </block>
</div>

<script>
var pageTitle = "";
var pageData = {pageTitle: pageTitle, children: []};

function alertContents() {
    if (httpRequest.readyState === XMLHttpRequest.DONE) {
      if (httpRequest.status === 200) {
        app.page = JSON.parse(httpRequest.responseText);
      } else {
        alert('There was a problem with the request.');
      }
    }
  }

Vue.component('block', {
  props: ['block', 'level'],
  data: function () {
    return {
      styleObject: {
        marginLeft: (this.level * 10) + "px"
      }
    }
  },
  template: '<span v-bind:style="this.styleObject">* <span v-html="block.text"></span><br /><block v-for="child in block.children" v-bind:block="child" v-bind:level="level + 1" v-bind:key="child.id"> </block></span>'
})

var app = new Vue({
  el: '#app',
  data: {page: pageData, currentRoute: window.location.pathname}
})

var httpRequest;
httpRequest = new XMLHttpRequest();
httpRequest.onreadystatechange = alertContents;
var apiRoute = "/api/daily-notes";
if (app.currentRoute != "/") { apiRoute = app.currentRoute.replace("app", "api") }
httpRequest.open('GET', apiRoute);
httpRequest.send();

</script>
